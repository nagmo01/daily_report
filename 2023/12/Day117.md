# 2023/12/19の日報


## 取り組んだこと
- 現場Rails chap3読む

## わかったこと
- 


## 次やること
- RailsのEC課題のカート機能のモデル、テーブルの構成を変更する。
- 現場rails chap3読む
- 現場rails chap4読む
- チェックアウト機能に入る

## 感じたこと

## 学習時間
- TODAY: 4h
- TOTAL: 506.5h



## 今日の学習メモ

### 現場rails chap3 - CRUDアプリの作る流れ

#### アプリケーション作成の準備をする

##### アプリケーションの雛形を作成
```
rails new アプリケーション名
```

例）
``rails new taskleaf -d postgresql``
-dはデータベースの指定でpostgreSQL

これで基本的なrailsアプリのファイル群が作成された。

##### データベースの作成
```
bin/rails db:create
```
でデータベースを作成する。

雛形を作成してデータベースを作成すると
rails sでlocalhost:3000が表示できるようになる。（railsのデフォルトページが出るだけ）

**データベースの環境ごとの使い分け**
開発、自動テスト、本番　それぞれ用のデータを用意しておく。
どの環境にどのようなデータベースを反映させるかは``config/database.yaml``に記述する。


##### ビュー層を効率良く書くためにテンプレートエンジンを利用する
デフォルトで設定されているERBの他にもslimやhamlなどというものがある。
ただし、実際の現場だとフロントはまた別の言語で実装されていそうなのでそこまで内蔵のテンプレートエンジンを深く学ぶ必要はないんじゃないかなと個人的に思った。erbのまま行う。


##### 見た目をよくするためにbootstrapを導入する
``Gemfile``にて
```
gem "bootstrap"
```
を記述し、
bundle installを実行することでbootstrapを利用できるようになる。

今の段階だとrailsアプリでbootstrapが利用できる状態になっているだけで、読み込む記述などをしていないので適用されていないため、その記述を行う。

**Railsアプリではアプリ全体で一つのCSSファイル(``app/assets/stylesheets/application.css``)を読み込むようになっていて、追加でCSSファイルなどを読み込ませたい場合は作成したCSSファイル自体をこの``application.css``からさらに読み込む形で記述する必要がある。
1. Railsアプリがapplication.cssを読み込む
2. 読み込まれたapplication.cssがその他のものを読み込む
のような流れをとる。
bootstrapもこの流れにそって
application.rb内に
```
@import "bootstrap";
```
のように記述する。

##### cssではなくSassを使う場合
``app/assets/stylesheets/application.css``を削除して
``app/assets/stylesheets/application.scss``という名前のsassファイルを作成する。
こうするだけで（たぶんRailsのなんらかのルールだと思うが）こちらのsassファイルが読み込まれるようになるので、あとは同じような役割としてこちらを使うだけで良い。
##### html.erb内でsassファイルの指定を行う
実際htmlファイルでcssを当てる場合、``<head>``だか``<body>``の中に``link ref="~~~~">``のような形でcssファイルのパスを指定して読み込ませる必要がある。railsで使う場合も同じだが、全てのファイルにその記述をする必要はなく、レイアウトファイルと呼ばれるファイル内にその記述を行えば他のerbファイルのなどでも使えるようになる。

##### 全体の流れ

``application.html.erb``などの共通レイアウトが``application.css``を読み込む。
``application.css``がbootstrapなどの他cssファイルを読み込む。

``application.html.erb``は共通レイアウトになっているのでここで読み込むと他の全てのファイルで表示が可能になる。

##### レイアウトファイルについて
何もしないとレイアウトファイルはコントローラに加えアクション単位まで指定できる。
ただし何も指定しないと全てのコントローラはApplicationControllerを継承するため、
``application.html.erb``が適用されている。
もし個別にコントローラやアクションで指定したい場合は
コントローラ名と同名のレイアウトファイルを作成する。


##### Railsのエラーメッセージを日本語で出せるようにする。


#### タスクモデルを作成する 

Railsでは全体的な設計などを除くとMVCでいうとモデルから作成するのが一般的。

**Modelは**
1. モデルに対応するRubyのクラス
2. モデルに対応するDBのテーブル
から構成される。

**命名規則**
**モデルのクラス名＝単数系でキャメルケース**
**テーブル名=複数形でスネークケース**

**テーブルでのカラムをモデルで扱うときは属性と呼ぶ**

##### タスクモデルの属性を設計する

どのような属性が必要か検討する。
また作成する属性はNULLが入ることが許容するか考え、nullはない方が良い場合は
null: falseのようにNULL制約をつける。

検討できたら
``$ rails g model [モデル名] [属性名:データ型,] [オプション]``
のような形で実行する。
モデル名は先頭大文字の単数系にする。

コマンドを実行すると
**1.  モデルのクラスファイル``app/models/task.rb``**
Taskクラスの実装
**2. マイグレーションファイル``db/migrate/2023~~~create_tasks.rb``**
データベースにtasksテーブルを追加するための設計図
**3. モデルの自動テストのファイル``test/models_task_test.rb``**
Taskクラスについての自動テストの実装

が生成される。
