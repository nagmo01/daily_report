# 2023/12/24の日報


## 取り組んだこと
- チェックアウト機能の構想を考える

## わかったこと
- draw.ioでER図が簡単に作れた


## 感じたこと
- 課題の要件に寄せるか実際のECサイトでありそうな方に寄せるかで結構変わりそう


## 次やること
- PRで修正がきたら対応
- チェックアウト機能に入る

- 
## 学習時間
- TODAY: 3h
- TOTAL: 522h



### 今日の学習メモ

##### チェックアウト機能と購入明細のDB構造を考える

チェックアウト機能に関しては
- 請求先情報テーブル(住所と支払い方法のみ保存する)
- 決済情報テーブル(cart_id,請求先テーブル_id)
- 購入された商品テーブル(決済情報テーブル_id,商品名,価格,説明文,数量)

購入された商品テーブルを別途作成して直接商品名などをカラムにするのはItemsテーブルに更新や削除があっても影響を受けないようにするため。

一応もう一つ購入されたカートテーブルのようなものを作成すれば
そこのカート_idを決済情報テーブルにカラムとして格納して
見た目上の関係はスッキリする気がする。
けど無駄にテーブルが一つ増える感じもする。
決済情報の部分を一回の会計ごとにわけるか、もうすでに購入されているものくらいの枠で管理するかでまたテーブルがかわる。
後者なら決済情報_idではなく、cart_idで管理できる。


ただ、普通のECサイトだとだいたい決済番号から照会すると思うので前者のやり方の方がベターな気はする。
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
請求先とお支払いは別のテーブルとして持っておいた方がよさそう。
請求先、支払いに関しては一つのユーザーにつき、１つずつとする。
もし変更したい場合は追加ではなく、変更という形にする。
請求先（id, name, email, address）
お支払い(id, name, number, limit, cvv)
これに関してはCartテーブルに(請求先_id, お支払い_id)という外部キーカラムを追加した方がよさそう。
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
↑これはない。（もちろん本当のECサイトならこの方が良い。）
課題のECサイトだと、チェックアウトページで毎回請求先と支払いの入力フォームがある状態なのでもしその実装をする場合ページ全体を変える必要がある。
例えばcheckboxを用意して
既存の請求先情報と支払い方法が存在していて、もし新しくしたい場合は
新規の方にチェックを入れると入力フォームが入力できるようになり、変更するを押すとCartテーブルの請求先を更新したあとcarts#indexにリダイレクトするような仕組みにする必要性がありそう。

これは結構面白いしアリかもしれない。（Cartの構成を変えるためエラーが怖いので余裕があればやるくらいにしとくか）
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
```
ユーザー情報的には請求先や支払い方法は一切保持せずに、あくまで決済時の記録としてのみ保存するというやり方の場合。
```

↑多分このやり方で十分っぽい。
上のやり方だと別に請求先と支払いを別テーブルにする必要性もそこまで感じない。
